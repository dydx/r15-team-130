  <script src="//maps.google.com/maps/api/js?v=3.13%amp;sensor=false%amp;libraries=geometry" type="text/javascript"></script>
  <script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<p id="notice"><%= notice %></p>

<div class="row">
  <h2><%= @conference.name %></h2>
</div>
<hr>

<div class="row">
  <div class="col-md-2">
    <div class="panel panel-default">
      <div class="panel-heading" id="location">Nearby Stuff</div>
      <ul class="list-group">
        <li class="list-group-item" id="hotels"><span class="badge">15</span>Hotels</li>
        <li class="list-group-item" id="restaurants"><span class="badge">35</span>Food</li>
        <li class="list-group-item" id="transportation"><span class="badge">5</span>Transport</li>
        <li class="list-group-item" id="funstuff"><span class="badge">99</span>Fun Stuff</li>
      </ul>
    </div>
  </div>
  <div class="col-md-10"> 
    <div class="panel panel-default">
      <div class="panel-body"> 
        <div style='width: 100%;'>
          <div id="map" style='width: 100%; height: 400px;'></div>
        </div>
      </div>
    </div>
  </div>
</div>

<hr>

<div class="row well description">
  <div class="col-md-6">
    <p><strong>Description</strong></p>
    <p><%= @conference.description %></p>
  </div>
  <div class="col-md-6">
    <p><strong>Date</strong>: <%= @conference.dateandtime.strftime('%d %b %Y') %></p>
    <p><strong>Location</strong>: <%= @conference.address %></p>
  </div>
</div>

<script type='text/javascript'>
  locations_json = <%=raw @locations.to_json %>
  restaurants_json = <%=raw @restaurants.to_json %>
  transportation_json = <%=raw @transportation.to_json %>
  funstuff_json = <%=raw @funstuff.to_json %>
  hotels_json = <%=raw @hotels.to_json %>
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(locations_json);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(12);
    createSidebar(restaurants_json, '#restaurants');
    createSidebar(transportation_json, '#transportation');
    createSidebar(hotels_json, '#hotels');
    createSidebar(funstuff_json, '#funstuff');
  });
function createSidebarLi(json){

      return ("<li class='list-group-item'><a>" + json.name + "</a></li>");
  };
  function bindLiToMarker($li, marker){
    $li.on('click', function(){
      handler.getMap().setZoom(14);
      marker.setMap(handler.getMap());
      marker.panTo();
      google.maps.event.trigger(marker.getServiceObject(), 'click');
    })
  };

  function createSidebar(json_array, id){
    _.each(json_array, function(json){
      var $li = $( createSidebarLi(json) );
      $li.appendTo(id);
      bindLiToMarker($li, json.marker);
    });
  };
</script>

<%= link_to 'Edit', edit_conference_path(@conference) %> |
<%= link_to 'Back', conferences_path %>
